#!/usr/bin/env python3
"""Pre-push hook to run checks before pushing to remote."""

import subprocess
import sys


def run_command(cmd, description):
    """Run a command and return True if successful."""
    print(f"Running {description}...")
    result = subprocess.run(cmd, shell=True, capture_output=True, text=True)
    
    if result.returncode != 0:
        print(f"❌ {description} failed!")
        if result.stdout:
            print(result.stdout)
        if result.stderr:
            print(result.stderr)
        return False
    
    print(f"✓ {description} passed")
    return True


def main():
    """Run all pre-push checks."""
    print("=" * 60)
    print("Running pre-push checks...")
    print("=" * 60)
    
    checks = [
        ("python scripts/verify-version.py", "Version consistency check"),
        ("pytest", "Full test suite"),
    ]
    
    all_passed = True
    
    for cmd, description in checks:
        if not run_command(cmd, description):
            all_passed = False
    
    print("=" * 60)
    
    if all_passed:
        print("✓ All pre-push checks passed!")
        print("=" * 60)
        return 0
    else:
        print("❌ Some pre-push checks failed!")
        print("Fix the issues above or use 'git push --no-verify' to skip checks.")
        print("=" * 60)
        return 1


if __name__ == "__main__":
    sys.exit(main())
